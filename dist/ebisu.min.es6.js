'use strict';(function(k){"object"===typeof exports&&"undefined"!==typeof module?module.exports=k():"function"===typeof define&&define.amd?define([],k):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).ebisu=k()})(function(){return function(){function k(e,t,g){function l(a,d){if(!t[a]){if(!e[a]){var c="function"==typeof require&&require;if(!d&&c)return c(a,!0);if(b)return b(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",
d;}d=t[a]={exports:{}};e[a][0].call(d.exports,function(b){return l(e[a][1][b]||b)},d,d.exports,k,e,t,g)}return t[a].exports}for(var b="function"==typeof require&&require,c=0;c<g.length;c++)l(g[c]);return l}return k}()({1:[function(k,e,t){function g(a){let b=v.get(a);if(b)return b;b=f(a);v.set(a,b);return b}function l(b,a,c){return f(b)-f(b+c)+g(a+c)-g(a)}function b(b,a){return g(b)+g(a)-g(b+a)}function c(c,x,u,g,f){g=void 0===g?!0:g;const [h,r,k]=c;f=f||k;var p=u/k;const e=u/f;if(x){if(f===k)return f=
[h+p,r,k],g?a(c,x,u,f):f;var q=l(h+p/e*(1+e),h+p,r);p=l(h+p/e*(2+e),h+p,r);var n=m(q);p=d(p,2*q)}else{n=b(h,r);q=b(h+p,r);q=w([n,q],[1,-1])[0];n=d(b(h+p/e,r)-q,b(h+p/e*(e+1),r)-q);p=d(b(h+2*p/e,r)-q,b(h+p/e*(e+2),r)-q);if(0>=p)throw Error("invalid second moment found");p-=Math.pow(n,2)}if(0>=n)throw Error("invalid mean found");if(0>=p)throw Error("invalid variance found");p=n*(1-n)/p-1;const [v,t]=[n*p,(1-n)*p];f=[v,t,f];return g?a(c,x,u,f):f}function a(b,a,f,d){const [g,r]=d;return g>2*r||r>2*g?
(d=h(d,.5,!0),c(b,a,f,!1,d)):d}function d(b,a){const c=Math.max(b,a);return m(c)*(m(b-c)-m(a-c))}function h(a,c,d,f){function g(a){return b(h+m(a),w)-l-r}c=void 0===c?.5:c;d=void 0===d?!1:d;f=void 0===f?1E-4:f;if(0>c||1<c)throw Error("percentiles must be between (0, 1) exclusive");const [h,w,e]=a,l=b(h,w),r=n(c),v=d?1:6;a=-v/2;c=v/2;let u=g(a),q=g(c);for(;0<u&&0<q;)a=c,u=q,c+=v,q=g(c);for(;0>u&&0>q;)c=a,q=u,a-=v,u=g(a);if(!(0<u&&0>q))throw Error("failed to bracket");if(d)return(m(a)+m(c))/2*e;d={};
f=k("minimize-golden-section-1d")(a=>Math.abs(g(a)),{lowerBound:a,upperBound:c,tolerance:f},d);if(!d.converged)throw Error("failed to converge");return m(f)*e}var f=k("gamma").log;const w=k("./logsumexp"),m=Math.exp,n=Math.log,v=new Map;e.exports={updateRecall:c,predictRecall:function(a,b,c){c=void 0===c?!1:c;const [d,f,g]=a;a=l(d+b/g,d,f);return c?m(a):a},defaultModel:function(a,b,c){b=void 0===b?4:b;return[b,void 0===c?b:c,a]},modelToPercentileDecay:h}},{"./logsumexp":2,gamma:3,"minimize-golden-section-1d":4}],
2:[function(k,e,t){var g=Math.exp,l=Math.log,b=Math.sign,c=Math.max;e.exports=function(a,d){var h=c(...a),f=0;for(let b=a.length-1;0<=b;b--)f+=d[b]*g(a[b]-h);a=b(f);return[l(f*a)+h,a]}},{}],3:[function(k,e,t){function g(c){if(0>c)return Number("0/0");for(var a=b[0],d=b.length-1;0<d;--d)a+=b[d]/(c+d);d=c+4.7421875+.5;return.5*Math.log(2*Math.PI)+(c+.5)*Math.log(d)-d+Math.log(a)-Math.log(c)}var l=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,
-.13857109526572012,9.984369578019572E-6,1.5056327351493116E-7],b=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3.399464998481189E-5,4.652362892704858E-5,-9.837447530487956E-5,1.580887032249125E-4,-2.1026444172410488E-4,2.1743961811521265E-4,-1.643181065367639E-4,8.441822398385275E-5,-2.6190838401581408E-5,3.6899182659531625E-6];e.exports=function d(a){if(.5>a)return Math.PI/(Math.sin(Math.PI*a)*d(1-a));if(100<a)return Math.exp(g(a));--a;for(var b=l[0],
f=1;9>f;f++)b+=l[f]/(a+f);f=a+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(f,a+.5)*Math.exp(-f)*b};e.exports.log=g},{}],4:[function(k,e,t){var g=k("./src/golden-section-minimize"),l=k("./src/bracket-minimum"),b=[0,0];e.exports=function(c,a,d){a=a||{};var h=void 0===a.tolerance?1E-8:a.tolerance,f=void 0===a.initialIncrement?1:a.initialIncrement,e=void 0===a.lowerBound?-Infinity:a.lowerBound,m=void 0===a.upperBound?Infinity:a.upperBound,n=void 0===a.maxIterations?100:a.maxIterations;d&&(d.iterations=0,
d.argmin=NaN,d.minimum=Infinity,d.converged=!1);if(isFinite(m)&&isFinite(e))b[0]=e,b[1]=m;else if(a=void 0===a.guess?-Infinity<e?Infinity>m?.5*(e+m):e:Infinity>m?m:0:a.guess,l(b,c,a,f,e,m,n),isNaN(b[0])||isNaN(b[1]))return NaN;return g(c,b[0],b[1],h,n,d)}},{"./src/bracket-minimum":5,"./src/golden-section-minimize":6}],5:[function(k,e,t){e.exports=function(g,e,b,c,a,d,h){var f,l,m;h=1;var n=m=b;for(l=f=b=e(b);!k&&isFinite(c)&&!isNaN(c);){++h;var k=!0;f<=l&&(l=f,m=Math.max(a,m-c),f=e(m),k=!1);b<=l&&
(l=b,n=Math.min(d,n+c),b=e(n),k=!1);l=Math.min(l,f,b);if(f===l&&m===a||b===l&&n===d)k=!0;c*=4>h?2:Math.exp(.5*h);if(!isFinite(c))return g[0]=-Infinity,g[1]=Infinity,g}g[0]=m;g[1]=n;return g}},{}],6:[function(k,e,t){var g=2/(1+Math.sqrt(5));e.exports=function(e,b,c,a,d,h){for(var f=0,k=c-g*(c-b),m=b+g*(c-b),n=e(k),l=e(m),r=e(b),t=e(c),u=b,q=c;++f<d&&Math.abs(c-b)>a;)l>n?(c=m,m=k,l=n,k=c-g*(c-b),n=e(k)):(b=k,k=m,n=l,m=b+g*(c-b),l=e(m));e=.5*(c+b);b=.5*(n+l);h&&(h.iterations=f,h.argmin=e,h.minimum=b,
h.converged=!0);return isNaN(l)||isNaN(n)||f===d?(h&&(h.converged=!1),NaN):r<b?u:t<b?q:e}},{}]},{},[1])(1)});
